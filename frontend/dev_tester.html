<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AI Anchor - Dev Tester</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 20px; }
      textarea { width: 100%; height: 160px; }
      select, button { margin: 8px 0; }
      pre { background: #f6f8fa; padding: 12px; border-radius: 6px; white-space: pre-wrap; }
    </style>
  </head>
  <body>
    <h2>AI Anchor - Dev Tester (no extension)</h2>
    <label>Action:
      <select id="action">
        <option value="summarize">summarize</option>
        <option value="explain_layman">explain_layman</option>
        <option value="explain_detailed">explain_detailed</option>
        <option value="sentiment">sentiment</option>
        <option value="find_sources">find_sources</option>
      </select>
    </label>
    <br />
    <textarea id="text" placeholder="Paste text here..."></textarea>
    <br />
    <button id="run">Run</button>
    <h3>Result</h3>
    <pre id="out">(nothing yet)</pre>

    <script>
      const BACKEND_URL = 'http://192.168.0.125:8000/api/analyze';
      const out = document.getElementById('out');
      document.getElementById('run').addEventListener('click', async () => {
        const text = document.getElementById('text').value;
        const action = document.getElementById('action').value;
        out.textContent = 'Loading...';
        try {
          const controller = new AbortController();
          const timer = setTimeout(() => controller.abort(), 45000);
          const resp = await fetch(BACKEND_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text, action }),
            signal: controller.signal,
          });
          clearTimeout(timer);
          const contentType = resp.headers.get('content-type') || '';
          const body = contentType.includes('application/json') ? (await resp.json()) : { raw: await resp.text() };
          if (!resp.ok) {
            out.textContent = `HTTP ${resp.status}: ${body.detail || body.raw || JSON.stringify(body)}`;
            return;
          }
          out.textContent = body.result || body.raw || JSON.stringify(body);
        } catch (e) {
          out.textContent = 'Request failed: ' + (e?.message || e);
        }
      });
    </script>
  </body>
  </html>
